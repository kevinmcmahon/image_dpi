# Image DPI Tool 🖼️🔎

## Summary of Project

This project provides a simple command-line tool and Python library for detecting and setting the DPI (dots per inch) of various image formats (PNG, JPEG, TIFF, and more). It leverages the Pillow (PIL) and ExifRead libraries to extract and manipulate DPI information from image metadata (EXIF and pHYs chunks). 

The tool is designed to be robust, handling cases where DPI information is missing or inconsistent, and providing helpful diagnostics. It's especially useful for tasks related to printing, publishing, scanning, and design work, where controlling image resolution is crucial.

## How to Use

The tool can be used both as a command-line utility and as a Python library.

### Installation 🚀

```bash
# Clone the repository
git clone https://github.com/harperreed/image-dpi.git
cd image-dpi

# Install using pip (recommended)
pip install .

# OR install in development mode (for contributing):
pip install -e .

# You can also use uv:
uv pip install .
uv pip install -e .
```

### Command-Line Usage 💻

1. **Check DPI:**

    ```bash
    image-dpi /path/to/image.jpg
    # OR
    python -m image_dpi /path/to/image.png
    ```

    This command analyzes the image file and prints the detected DPI information to the console. It provides details from PIL and ExifRead, and performs direct PNG chunk analysis.

2. **Set DPI (Creates a new file):**

    ```bash
    image-dpi /path/to/image.png --set-dpi 300
    #OR
    python -m image_dpi /path/to/image.jpeg --set-dpi 150
    ```

    This command creates a *new* image file with the specified DPI.  The new file will have the same name as the original, but with `_dpi` appended before the extension (e.g., `image_dpi.png`).  The original file is *not* modified.

### Library Usage (Python) 🐍

```python
from image_dpi import get_image_dpi, set_image_dpi
from PIL import Image

# Get DPI
image_path = "path/to/your/image.jpg"
dpi_info = get_image_dpi(image_path)
print(f"DPI Information: {dpi_info}")


# Set DPI
image = Image.open(image_path)
new_image_path = "path/to/new_image.png"  # Specify output path!
set_image_dpi(image, new_image_path, dpi=300)

print(f"New image with DPI 300 saved to {new_image_path}")

#Example output from get_image_dpi
#{'pil_dpi': (72.0, 72.0), 'exif_dpi': (72, 72), 'png_chunk_dpi': None, 'status': 'OK', 'messages': []}

```

**Key Considerations:**

* The `get_image_dpi` function returns a dictionary containing DPI information from various sources (PIL, ExifRead, PNG chunks). It also includes a `status` field ("OK", "WARNING", "ERROR") and a `messages` list providing diagnostic details.
* The `set_image_dpi` function *creates a new file*. It does not modify the original image.  Always provide an explicit `new_image_path`.
* The functions handle various error cases. If the DPI cannot be determined, a warning status is returned, and the reason is included in the diagnostics message.

## Tech Info 🛠️

* **Programming Language:** Python 3.8+
* **Dependencies:**
  * Pillow (>= 9.0.0): For image manipulation and accessing PIL's internal DPI information.
  * ExifRead (>= 3.0.0): For extracting DPI from EXIF metadata (primarily used for JPEG and TIFF images).
* **Project Structure:**
  * `src/image_dpi/__init__.py`: Contains the core functions `get_image_dpi`, `set_image_dpi` and `main`.
  * `src/image_dpi/__main__.py`: Handles command-line argument parsing and calls the appropriate functions.
  * `pyproject.toml`: Defines project metadata, dependencies, and build settings.
  * `.gitignore`: Specifies intentionally untracked files that Git should ignore.
  * `uv.lock`: Specifies the pinned version for the dependencies, generated by uv.
* **DPI Detection Logic:**
    1. **PIL (Pillow):** The tool first attempts to retrieve DPI from the `image.info` dictionary provided by Pillow. This works for formats where Pillow automatically handles DPI.
    2. **ExifRead:** For formats like JPEG and TIFF, ExifRead is used to extract DPI information from the EXIF metadata. The tool specifically looks for the `XResolution` and `YResolution` tags.
    3. **PNG Chunk Analysis:** For PNG images, the tool directly reads the file's chunks to find the `pHYs` chunk. This chunk contains the pixel density information, which is used to calculate DPI. This is a more reliable method than relying solely on PIL for PNGs.
* **Error Handling:** If the DPI cannot be detected using any of the above methods, the tool returns a warning message, and reports detailed diagnostic information.
* **DPI Setting:** The tool uses Pillow's `save` function with the `dpi` parameter to set the DPI for the output image. The `save` function supports various image formats, including PNG and JPEG.
* **Test Images** Test images that would match the pattern `*_dpi.*` are added in `.gitignore`

## When to use this tool

This tool is helpful for:

- Printing: When you need to ensure proper physical size when printing
- Publishing: When you need to meet specific DPI requirements for publications
- Scanning: To verify the resolution of scanned documents
- Design work: When working with images that need precise physical dimensions

